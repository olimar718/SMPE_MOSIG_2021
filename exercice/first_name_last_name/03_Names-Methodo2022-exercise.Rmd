---
title: "French given names exercise"
author: "Benjamin Cathelineau"
date: "October, 2021"
output:
  word_document: default
  html_document:
    df_print: paged
  pdf_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
options(max.print = 10)
```

```{r}
# The environment
library(tidyverse)
library(ggplot2)
version
```

## Download Raw Data from the website

File downloaded from [https://www.insee.fr/fr/statistiques/fichier/2540004/dpt2020_csv.zip](https://www.insee.fr/fr/statistiques/fichier/2540004/dpt2020_csv.zip)

## Build the Dataframe from file

*I had to change the name of the file because it wasn't the correct one.*
```{r}
FirstNames <- readr::read_delim("dpt2020.csv",delim=";")

```


# 1. Choose a firstname and analyse its frequency along time. Compare several first names frequency

*First we can find all the different names using the following command. This will group all the entries by * ***preusel***

```{r }
table(FirstNames$preusuel)
```

*Then, using the following* ***dplyr*** *pipeline we can see the one that occurs the most often.*

```{r }
library(dplyr)
FirstNames %>% count(preusuel) %>% arrange(desc(n)) 

```

*We just have to divide each "count" by the total in order to find the * ***frequency*** *for that we use * ***mutate.*** *We also* ***group_by*** *year*.

```{r }
library(dplyr)
frequencies=FirstNames %>% group_by(annais) %>%count(preusuel) %>% arrange(desc(n)) %>% mutate(frequency=n/nrow(FirstNames)) 
frequencies
```

*THe following command gives the frequency* ***by year*** *for a single name*

```{r }
frequencies_benjamin=frequencies %>% filter(preusuel=="BENJAMIN")
plot(frequencies_benjamin$annais,frequencies_benjamin$frequency )
```

*We can even check our result with* ***sum*** *which should be equal to 1*
```{r }
# To get the frequency
library(dplyr)
sum( frequencies$frequency)
```



# 2. Establish, by gender, the most given firstname by year. 

*We use* ***group by*** *for that, and* ***filter*** *to only keep the maximum*
```{r }
library(dplyr)
most_given_by_year_and_gender=FirstNames %>% group_by(sexe,annais) %>% filter(nombre==max(nombre)) 

ggplot(data = most_given_by_year_and_gender %>% filter(1999<=as.numeric( annais) & as.numeric( annais) <=2010 ), aes(x=annais, y=nombre, shape = factor(sexe), color = preusuel))+geom_point()
```



3. Make a short synthesis

*There is definitively something strange going on with this data, specifically with the entries "_PRENOMS_RARES", which could be translated to rare First names.*

*Indeed theses entries dominate in term of frequency, be it in the total, or even when grouping by gender and year*

*I'm not sure what rare first name exactly means when there are many other rare first name, that is names that occur no more than once* 

*In my opinion theses name are also rare and should be in the "_PRENOMS_RARES" category* TODO
 


*Finally, we can say that some name are used both for men and women, so it's something to keep in mind*

*For example the name CAMILLE is given almost equally for men and women*
```{r }
library(dplyr)
total_women= FirstNames %>% filter(preusuel == 'CAMILLE') %>% filter(sexe == 2)
total_men=FirstNames %>% filter(preusuel == 'CAMILLE') %>% filter(sexe == 1)
nrow(total_men)
nrow(total_women)
```

